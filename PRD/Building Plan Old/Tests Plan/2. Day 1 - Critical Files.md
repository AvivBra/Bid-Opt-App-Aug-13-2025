# בדיקות יום 1 - אחרי מימוש 4 קבצים קריטיים

## מה האפליקציה אמורה לעשות בשלב זה

### עובד:
- **Upload Tab**: מלא ופונקציונלי
- **השוואת פורטפוליוז**: מזהה חסרים ועודפים
- **לולאת Completion**: מורידה template, מקבלת העלאה, מתעדכנת
- **מונה איטרציות**: סופר עד 10 ומציג "Attempt X/10"
- **Virtual Map**: מאותחל, מתעדכן, קופא בסוף Step 2
- **הודעות ברורות**: missing/excess portfolios

### לא עובד עדיין:
- **Output Tab**: עדיין לא מייצר קבצים אמיתיים
- **שמות קבצים דינמיים**: עדיין לא מומש
- **הפרדת לוגיקה מ-UI**: הכל עדיין ב-validate_tab.py
- **Mockup Scenario Selector**: אולי לא מחובר

## קבצים שמומשו
- services/step2_service.py
- core/validate/portfolio_comparison.py
- core/validate/completion_validator.py
- models/step2_models.py

## בדיקות משתמש

### תרחיש 1: אין חסרים
1. העלה template: portfolios A, B, C
2. העלה bulk: portfolios A, B, C
3. **צפוי**: 
   - "All portfolios complete ✓"
   - כפתור Continue זמין

### תרחיש 2: חסרים בלבד
1. העלה template: A, B
2. העלה bulk: A, B, C, D
3. **צפוי**:
   - "2 missing portfolios: C, D"
   - הורדת completion template אוטומטית
   - "Attempt 1/10"

### תרחיש 3: עודפים בלבד
1. העלה template: A, B, C, D
2. העלה bulk: A, B
3. **צפוי**:
   - "2 excess portfolios: C, D"
   - כפתור Continue זמין

### תרחיש 4: מגבלת 10 איטרציות
1. העלה completion חלקי
2. חזור 10 פעמים
3. **צפוי**: "Maximum iterations reached (10/10)"

## בדיקות מפתח

### בדיקת גודל קבצים
```bash
wc -l services/step2_service.py         # צפוי: 200+ שורות
wc -l core/validate/portfolio_comparison.py  # צפוי: 100+ שורות
```

### בדיקת Virtual Map
בהרצה, הוסף debug זמני:
```python
print(f"Virtual Map size: {len(virtual_map.data)}")
print(f"Iteration: {session.completion_iteration_count}")
```

### בדיקת Freeze
1. אחרי השלמת comparison - וודא ש-virtual_map_frozen = True
2. נסה לשנות - צריך להיכשל

## סימני הצלחה
✅ לולאת completion עובדת
✅ מונה איטרציות מתעדכן
✅ אין קריסות
✅ הודעות ברורות
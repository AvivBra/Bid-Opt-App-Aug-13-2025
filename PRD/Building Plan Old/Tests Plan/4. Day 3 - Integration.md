# בדיקות יום 3 - אינטגרציה מלאה

## מה האפליקציה אמורה לעשות בשלב זה

### עובד - המערכת השלמה:
- **זרימה מלאה**: Upload → Validate → Output עובדת מקצה לקצה
- **Output Tab פונקציונלי**: מייצר Working File ו-Clean File
- **שמות קבצים דינמיים**: "Auto Optimized Bulk | Type | YYYY-MM-DD | HH-MM.xlsx"
- **Operation="Update"**: בכל השורות בקבצי הפלט
- **Bulk Cleanse**: מסנן נכון (רק Keyword/Product Targeting, רק enabled)
- **New Processing**: מאפס הכל וחוזר ל-Upload נקי
- **כל התרחישים**: חסרים, עודפים, שניהם, אין בעיות
- **מגבלת 10 איטרציות**: אכופה עם הודעת שגיאה ברורה

### לא עובד (כי זה מוקאפ):
- **חישובי Bid אמיתיים**: הערכים נשארים כמו במקור
- **עמודות עזר**: לא נוספות ל-Working File
- **13 סוגי אופטימיזציה נוספים**: רק Zero Sales קיים

## מטרה
לוודא שכל המערכת עובדת מקצה לקצה

## בדיקות משתמש - זרימה מלאה

### זרימה ראשית (Happy Path)
1. **Upload**:
   - העלה Template + Bulk
   - סמן Zero Sales
   - לחץ Continue

2. **Validate**:
   - ראה 2 missing
   - הורד completion template
   - מלא ב-Excel
   - העלה חזרה
   - ראה "All complete"
   - לחץ Continue

3. **Output**:
   - ראה Progress Bar
   - הורד Working File
   - הורד Clean File
   - לחץ New Processing

4. **צפוי**: חזרה ל-Upload נקי

## בדיקות קבצי Output

### Working File
- פתח את הקובץ
- **בדוק**:
  - כל השורות: Operation = "Update"
  - שם: "Auto Optimized Bulk | Working | YYYY-MM-DD | HH-MM.xlsx"

### Clean File
- פתח את הקובץ
- **בדוק**:
  - רק Entity = "Keyword" או "Product Targeting"
  - רק State = "enabled"

## בדיקות מפתח

### בדיקת Reset
```python
# לפני Reset
print(len(st.session_state.keys()))  # צפוי: 10+

# אחרי Reset
print(len(st.session_state.keys()))  # צפוי: 0 או מינימום
```

### בדיקת שמות דינמיים
```bash
# הורד קובץ פעמיים
# וודא ששמות שונים (זמן שונה)
```

### בדיקת Bulk Cleanse
- שורות לפני: 1000
- שורות אחרי: ~300 (רק enabled)

## בדיקות ביצועים

### קובץ גדול
1. העלה bulk של 30MB
2. **צפוי**: עובד תוך 30 שניות

### הרבה portfolios
1. העלה 50 portfolios
2. **צפוי**: עובד חלק

## סימני הצלחה
✅ זרימה מלאה עובדת
✅ קבצים נוצרים נכון
✅ Reset מנקה הכל
✅ ביצועים סבירים
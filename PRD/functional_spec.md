# אפיון פונקציונלי – Bid & Budget Optimizer (Streamlit)

## 1. מטרת המוצר
כלי פנימי ואישי לביצוע אופטימיזציה של בידים ובאג'טים על קובצי Amazon Bulk, בתהליך תלת־שלבי, ללא חיבור ל־API וללא שמירת נתונים בין הרצות.

## 2. קהל יעד
משתמש יחיד (בעל המערכת), ללא שיתוף חיצוני.

## 3. מגבלות
- שימוש אישי בלבד.
- אין חיבור ל־API.
- אין שמירת נתונים בין הרצות.
- אין ניתוחים ויזואליים.
- מתמקדת בבידים ובאג'טים בלבד.

## 4. שלבים

### שלב 1 – Upload
**קלטים**:
- Bulk File – Excel/CSV, עד 40MB, עד 500,000 שורות, לשונית עיקרית: Sponsored Product Campaigns.
- Template – ניתנת להורדה, עם עמודות Portfolio Name, Base Bid, Target CPA, אפשרות Ignore.
- Checklist – בחירת סוגי אופטימיזציה.

**ולידציה**:
- קבצים לא ריקים.
- כותרות נדרשות קיימות במבנה קבוע.
- לפחות סוג אופטימיזציה אחד נבחר.

---

### שלב 2 – Validate Portfolios
**פעולות**:
1. ניקוי ראשוני של לשונית Sponsored Product Campaigns.
2. השוואת פורטפוליוז בין Template ל־Bulk.

תרחישים:
- חוסרים בלבד – Completion Template בלולאה עד שאין חוסרים. 
- כפתור ההעלאה נהיה לא פעיל מיד אחרי העלאה מוצלחת וחוזר לפעיל רק אם יש עדיין חוסרים.
- עודפים בלבד – Copy to Clipboard + כפתור מעבר.
- חוסרים ועודפים – שילוב שני המנגנונים, כפתור מעבר מוצג (disabled) ומתאפשר רק אחרי מילוי כל החוסרים.

#### Virtual Map (תוצר Step 2)
- במהלך לולאת ההשלמה, כל העלאת Completion Template ממוזגת לטבלת עבודה פנימית ("Virtual Map").
- ה‑Virtual Map ממפה: Portfolio Name → { Base Bid (חובה), Target CPA (אופציונלי) }.
- Step 2 מסתיים כשה‑Virtual Map כולל ערכים לכל הפורטפוליוז שבהם מטפלים (אחרי Ignore).

### Virtual Map - ניהול מצבים

#### מצב "חי" (Step 2):
- Virtual Map מתעדכן עם כל העלאת Completion Template
- ניתן לשינוי ועריכה
- ממזג נתונים חדשים באופן דינמי

### כללי Virtual Map - מיזוג ודריסה

#### כללי מיזוג
- **דריסה מלאה**: ערכים מ-Completion Template דורסים ערכים קיימים
- **Ignore מוחק**: פורטפוליו עם Base Bid="Ignore" נמחק מה-Virtual Map
- **שמירת קיים**: פורטפוליוז שלא מופיעים ב-Completion נשארים ללא שינוי

#### ולידציות
- Base Bid חסר/לא תקין - חזרה למילוי Completion Template
- Target CPA לא תקין - הודעת שגיאה וחזרה למילוי
- Portfolio לא קיים ב-Bulk - הודעת שגיאה עם שם הפורטפוליו

#### Completion Template
- מבנה זהה ל-Template הרגיל (3 עמודות זהות)
- Portfolio Name ממולא אוטומטית
- משמש רק ב-Step 2

#### מצב "קפוא" (Step 3):
- ברגע המעבר ל-Step 3, ה-Virtual Map ננעל
- Step 3 עובד על עותק קפוא של הנתונים
- לא מקבל עדכונים או שינויים

#### חזרה בין שלבים:
- Step 3 → Step 2: Virtual Map מופשר לעריכה
- Step 2 → Step 3: Virtual Map קופא מחדש עם הנתונים המעודכנים
- כל חזרה ל-Step 3 מריצה מחדש את כל החישובים

### תנאי קדם ל‑Step 3
- Step 3 מתחיל עם Virtual Map קפוא/סגור המתקבל מסוף Step 2.
- אין הפקות או מיזוגים של Completion Template בשלב 3.


---

### שלב 3 – Optimization & Output
**תהליך מלא**:
- חישובי אופטימיזציה לפי סוגי האופטימיזציה שנבחרו.

**פלטים**:
- Working File – לשוניות Clean + לשוניות Working (עם עמודות עזר).
- Clean File – לשוניות Clean בלבד (שם: "Clean" + סוג האופטימיזציה).

**איפוס**:
- כפתור "עיבוד נוסף" – איפוס מוחלט.


## 4.1 כללי ניווט ואיפוס

### ניווט בין שלבים
- המשתמש יכול לעבור בין הטאבים בכל עת
- מעבר בין טאבים **לא מבצע שום פעולה** - רק מציג את המצב הנוכחי
- נתונים נשארים במצבם מרגע השלמת השלב

### איפוס מערכת
התהליך מתאפס **במלואו** ב-2 מצבים:
1. **לחיצה על "New Processing"** בשלב 3
2. **כל שינוי בשלב 1**:
   - העלאת קובץ חדש (Template או Bulk)
   - שינוי בבחירת אופטימיזציה
   - הורדת Template חדש

### אין תיקון חלקי
- **אסור** לאפשר תיקון נתונים בשלב 2 לאחר מעבר לשלב 3
- **אסור** לאפשר שינוי Virtual Map לאחר הקפאה
- תיקון = איפוס מלא והתחלה מחדש


---

## 5. גרסת Mockup
גרסת המוקאפ היא מוקאפ פונקציונלי מלא עם UI עובד וזרימה מלאה, לא דמו ויזואלי בלבד. המוקאפ מדגים את כל הפונקציונליות החיצונית וה־UI של המוצר, אך אינו כולל חישוב או לוגיקה אמיתית של אופטימיזציה.

המפתח אינו נדרש להבין, ליישם או לתכנן את חישובי הבידים/באג'טים בשלב זה – הפיתוח הנוכחי מתמקד אך ורק בממשק, בזרימת השלבים, ובמבנה קבצי הקלט/פלט.

### מה כולל המוקאפ:
- **UI מלא ופונקציונלי** - כל 3 הטאבים עובדים
- **קריאה וכתיבה של קבצים אמיתיים** - Excel/CSV
- **Virtual Map פעיל** - ניהול פורטפוליוז
- **לולאת Completion Template** - עובדת במלואה
- **Mockup Scenario Selector** - לבדיקת תרחישים שונים (חלק אינטגרלי מהמוקאפ)

### מה לא כולל המוקאפ:
- חישובי Bid/Budget אמיתיים
- עמודות עזר בקבצי הפלט
- 14 סוגי אופטימיזציה (רק Zero Sales)

שלבים 1 ו־2 – פועלים במלואם כפי שיהיו באפליקציה הסופית.

שלב 3 – מייצר קבצים זהים לקובץ ה־Bulk המקורי, עם לשוניות לפי סוג האופטימיזציה שנבחר, אך ללא שינויי ערכים או חישובים. כל השורות מקבלות Operation="Update".

סוג אופטימיזציה יחיד – Zero Sales (לעומת עד 14 בגרסה הסופית).

כל שאר הזרימה, הממשק והקבצים – זהים לגרסה הסופית.


## 7. שפת האפליקציה
האפליקציה כולה תפותח באנגלית בלבד:
- כל ממשק המשתמש
- כל ההודעות והשגיאות
- שמות קבצים וכותרות
- תיעוד קוד והערות
- אין צורך בתמיכה בעברית או בכל שפה אחרת
# השוואת פורטפוליוז - מפרט תמציתי

## מטרה
זיהוי פורטפוליוז חסרים ועודפים בין הבלק המנוקה לוירטואל מאפ.

## קלט
1. רשימת פורטפוליוז מהבלק המנוקה
2. וירטואל מאפ (פורטפוליוז מהטמפלט)
3. רשימת פורטפוליוז מסומנים כאיגנור

## לוגיקת השוואה

| סוג | הגדרה |
|-----|--------|
| **חסרים** | קיימים בבלק המנוקה, לא בוירטואל מאפ, לא באיגנור |
| **עודפים** | קיימים בוירטואל מאפ, לא בבלק המנוקה |

## פלט
```python
{
    "missing": ["Port_A", "Port_B"],
    "excess": ["Port_X", "Port_Y"]
}
```

## תרשים זרימה

```
[השוואת פורטפוליוז]
    ↓
[בדיקת תוצאות]
    ├─[אין חסרים/עודפים] → [טריגור סטפ 3]
    ├─[חסרים בלבד] → [לולאה*]
    ├─[עודפים בלבד] → [הצגת עודפים] + [כפתור העתקה] + [טריגור סטפ 3]
    └─[חסרים + עודפים] → [הצגת עודפים] + [כפתור העתקה] + [לולאה*]

*ראה תרשים לולאת השלמה למטה
```

# תרשים לולאת השלמה מתוקן

## תרשים זרימה

```
[לולאת השלמה]
    ↓
[יצירת Completion Template עם פורטפוליוז חסרים]
    ↓
[הורדת הקובץ ע"י המשתמש]
    ↓
[מילוי Base Bid (חובה) + Target CPA (אופציונלי)]
    ↓
[העלאת Completion Template חזרה]
    ↓
[ולידציה]
    ├─[כל הערכים תקינים] → [מיזוג לוירטואל מאפ] → [ניקוי בלק מחדש] → [חזרה להשוואה]
    └─[יש ערכים שגויים] → [יצירת Completion Template חדש עם:
                              • פורטפוליוז עם שגיאות (עם עמודת Error)
                              • פורטפוליוז שעדיין חסרים (אם יש)]
                           → [הצגת הודעה S2-007] 
                           → [חזרה להורדת טמפלט]
```

## הסבר התהליך

### במקרה של ערכים תקינים:
1. כל הפורטפוליוז התקינים ממוזגים לוירטואל מאפ
2. הבאלק מנוקה מחדש
3. חוזרים להשוואה לבדוק אם עדיין יש חסרים

### במקרה של ערכים שגויים:
1. נוצר קומפלישן טמפלט חדש שכולל:
   - **פורטפוליוז עם שגיאות** - עם עמודה רביעית "Error" שמכילה: "Invalid value, please correct"
   - **פורטפוליוז חסרים נוספים** - אם נמצאו עוד פורטפוליוז חסרים בבאלק שלא היו בקומפלישן הקודם
2. מוצגת הודעה S2-007: "Missing or invalid values found. Please download template, fill and upload again"
3. המשתמש צריך להוריד את הטמפלט המשולב, לתקן את השגויים ולמלא את החסרים